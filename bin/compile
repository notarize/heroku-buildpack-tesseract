#!/bin/bash

BUILD_DIR=$1
TESSERACT_VERSION=4.1.1
ARCHIVE_REMOTE=https://notarize-dev-static-assets.s3.amazonaws.com/lib/tesseract-$TESSERACT_VERSION.tar.gz
REPO_DIR=$BUILD_DIR/package_repo/tesseract
SOURCES=$BUILD_DIR/sources.list

echo "-----> creating local tesseract $TESSERACT_VERSION repo in $REPO_DIR from $ARCHIVE_REMOTE"

mkdir -p $REPO_DIR
curl -s $ARCHIVE_REMOTE | tar xz -C $REPO_DIR

echo "       adding local tesseract $TESSERACT_VERSION repo to source list"

cat "/etc/apt/sources.list" > $SOURCES
echo "deb file:$REPO_DIR ./" >> $SOURCES
apt-get update -o dir::etc::sourcelist=$SOURCES

echo "       installing tesseract $TESSERACT_VERSION from local repo"

apt-get install -y tesseract-ocr

echo "       removing local tesseract $TESSERACT_VERSION repo from source list"

apt-get update
