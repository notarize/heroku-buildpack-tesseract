#!/bin/bash

BUILD_DIR=$1
TESSERACT_VERSION=4.1.1
ARCHIVE_REMOTE=https://notarize-dev-static-assets.s3.amazonaws.com/lib/tesseract-$TESSERACT_VERSION.tar.gz
REPO_DIR=$BUILD_DIR/package_repo/tesseract

echo "-----> creating local tesseract $TESSERACT_VERSION repo in $REPO_DIR from $ARCHIVE_REMOTE"

mkdir -p $REPO_DIR
curl -s $ARCHIVE_REMOTE | tar xz -C $REPO_DIR

echo "       adding local tesseract $TESSERACT_VERSION repo to source list"

echo "deb file:$REPO_DIR ./" | tee -a /etc/apt/sources.list
apt-get update

echo "       installing tesseract $TESSERACT_VERSION from local repo"

apt-get install -y tesseract-ocr

echo "       removing local tesseract $TESSERACT_VERSION repo from source list"

sed "/file:$REPO_DIR/d" file
apt-get update
